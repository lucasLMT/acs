--Create Database

set names utf8;

set sql dialect 3;

set clientlib 'gds32.dll';

create database 'C:\Users\lucas\Documents\ACS\posto.fdb'
user "SYSDBA" password 'masterkey'
page_size 16384
default character set utf8;

-- Tabelas

-- Imposto

CREATE TABLE IMPOSTO (
    ID        INTEGER NOT NULL,
    NOME      VARCHAR(30) NOT NULL,
    ALIQUOTA  DECIMAL(15,2) NOT NULL
);

ALTER TABLE IMPOSTO ADD CONSTRAINT PK_IMPOSTO PRIMARY KEY (ID);

-- Combustivel

CREATE TABLE COMBUSTIVEL (
    ID     INTEGER NOT NULL,
    NOME   VARCHAR(30) NOT NULL,
    PRECO  NUMERIC(18,4) NOT NULL
);

ALTER TABLE COMBUSTIVEL ADD CONSTRAINT PK_COMBUSTIVEL PRIMARY KEY (ID);

-- Tanque

CREATE TABLE TANQUE (
    ID           INTEGER NOT NULL,
    NOME         VARCHAR(30) NOT NULL,
    COMBUSTIVEL  INTEGER NOT NULL
);

ALTER TABLE TANQUE ADD CONSTRAINT PK_TANQUE PRIMARY KEY (ID);
ALTER TABLE TANQUE ADD CONSTRAINT FK_TANQUE_1 FOREIGN KEY (COMBUSTIVEL) REFERENCES COMBUSTIVEL (ID);

-- Bomba

CREATE TABLE BOMBA (
    ID      INTEGER NOT NULL,
    TANQUE  INTEGER NOT NULL,
    NOME    VARCHAR(30) NOT NULL
);

ALTER TABLE BOMBA ADD CONSTRAINT PK_BOMBA PRIMARY KEY (ID);
ALTER TABLE BOMBA ADD CONSTRAINT FK_BOMBA_1 FOREIGN KEY (TANQUE) REFERENCES TANQUE (ID);

-- Abastecimento

CREATE TABLE ABASTECIMENTO (
    ID            INTEGER NOT NULL,
    BOMBA         INTEGER NOT NULL,
    QUANTIDADE    NUMERIC(15,4) NOT NULL,
    DATA          DATE NOT NULL,
    HORA          TIME NOT NULL,
    TOTAL         NUMERIC(18,4) NOT NULL,
    VALORIMPOSTO  NUMERIC(18,4)
);

ALTER TABLE ABASTECIMENTO ADD CONSTRAINT PK_ABASTECIMENTO PRIMARY KEY (ID);
ALTER TABLE ABASTECIMENTO ADD CONSTRAINT FK_ABASTECIMENTO_1 FOREIGN KEY (BOMBA) REFERENCES BOMBA (ID);

-- Geradores

CREATE SEQUENCE GEN_ABASTECIMENTO_ID START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE GEN_BOMBA_ID START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE GEN_COMBUSTIVEL_ID START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE GEN_IMPOSTO_ID START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE GEN_TANQUE_ID START WITH 1 INCREMENT BY 1;

-- Triggers

CREATE OR ALTER TRIGGER COMBUSTIVEL_BI FOR COMBUSTIVEL
ACTIVE BEFORE INSERT POSITION 0
as
begin
  if (new.id is null) then
    new.id = gen_id(gen_combustivel_id,1);
end

CREATE OR ALTER TRIGGER BOMBA_BI FOR BOMBA
ACTIVE BEFORE INSERT POSITION 0
as
begin
  if (new.id is null) then
    new.id = gen_id(gen_bomba_id,1);
end

CREATE OR ALTER TRIGGER ABASTECIMENTO_BI FOR ABASTECIMENTO
ACTIVE BEFORE INSERT POSITION 0
as
begin
  if (new.id is null) then
    new.id = gen_id(gen_abastecimento_id,1);
end

CREATE OR ALTER TRIGGER IMPOSTO_BI FOR IMPOSTO
ACTIVE BEFORE INSERT POSITION 0
as
begin
  if (new.id is null) then
    new.id = gen_id(gen_imposto_id,1);
end

CREATE OR ALTER TRIGGER TANQUE_BI FOR TANQUE
ACTIVE BEFORE INSERT POSITION 0
as
begin
  if (new.id is null) then
    new.id = gen_id(gen_tanque_id,1);
end

